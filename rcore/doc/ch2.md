TODO: 上下文特权级切换

# 批处理系统

- 引入程序地址空间, 规定程序加载到该地址后才可运行(pc指针)
- 引用内核态和用户态切换的方法, trap。系统调用, 中断等会导致用户态下陷, 切换特权级
	* 切换机制
		+ 通过修改sstatus寄存器SPP字段修改当前特权级(trap.S)
			+ 上下文切换
		+ 使用sret从s特权级回到

## **如何理解用户程序**

如果说内核是: `clear_bss`然后调用内核主函数的话, 那用户程序就是标准库封装`clear_bss`然后调用用户程序主函数。


## 特权级切换细节

> 本质就是状态寄存器的自动切换加手动的初态设置

- TODO: trap是指需要从用户态(U级)进入到内核态(S级)这件事, 进入内核态以做一些特权操作，如读写文件。系统调用就是一个trap的例子
- trapframe就是内核进程和用户进程相互切换时保存上下文使用的空间

- `sstatus`寄存器的SPP记录CPU当前特权级(U/S)
- sepc, TODO
- scause/stval, TODO
- stvec, TODO


### abs

- 实现用户栈和内核栈来完成上下文切换
- trap上下文切换, TODO: 需要保存的寄存器
	* 保存上下文`__alltraps`, 执行`trap_handler`完成trap分发的处理, 恢复上下文`__restore`

